# =============================================================================
# Grafana Dashboard Provisioning - Auto-import Essential Dashboards
# =============================================================================
# This ConfigMap auto-provisions the Kubernetes monitoring dashboard
# =============================================================================
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-provider
  namespace: monitoring
  labels:
    app: grafana
data:
  dashboards.yaml: |
    apiVersion: 1
    providers:
      - name: 'kubernetes-dashboards'
        orgId: 1
        folder: 'Kubernetes'
        type: file
        disableDeletion: false
        updateIntervalSeconds: 60
        options:
          path: /var/lib/grafana/dashboards
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: monitoring
  labels:
    app: grafana
data:
  kubernetes-cluster.json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 70 },
                  { "color": "red", "value": 90 }
                ]
              },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 8, "w": 6, "x": 0, "y": 0 },
          "id": 1,
          "options": {
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "CPU Usage",
          "type": "gauge",
          "targets": [
            {
              "expr": "100 - (avg(irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
              "legendFormat": "CPU %"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 70 },
                  { "color": "red", "value": 85 }
                ]
              },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 8, "w": 6, "x": 6, "y": 0 },
          "id": 2,
          "options": {
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Memory Usage",
          "type": "gauge",
          "targets": [
            {
              "expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100",
              "legendFormat": "Memory %"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 70 },
                  { "color": "red", "value": 85 }
                ]
              },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 8, "w": 6, "x": 12, "y": 0 },
          "id": 3,
          "options": {
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Disk Usage",
          "type": "gauge",
          "targets": [
            {
              "expr": "(1 - (node_filesystem_avail_bytes{mountpoint=\"/\"} / node_filesystem_size_bytes{mountpoint=\"/\"})) * 100",
              "legendFormat": "Disk %"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "red", "value": null },
                  { "color": "green", "value": 1 }
                ]
              }
            }
          },
          "gridPos": { "h": 8, "w": 6, "x": 18, "y": 0 },
          "id": 4,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Nodes Ready",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(kube_node_status_condition{condition=\"Ready\",status=\"true\"})",
              "legendFormat": "Ready Nodes"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisLabel": "",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "showPoints": "auto"
              },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 },
          "id": 5,
          "title": "CPU Usage Over Time",
          "type": "timeseries",
          "targets": [
            {
              "expr": "100 - (avg by(instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
              "legendFormat": "{{ instance }}"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisLabel": "",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "showPoints": "auto"
              },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 8 },
          "id": 6,
          "title": "Memory Usage Over Time",
          "type": "timeseries",
          "targets": [
            {
              "expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100",
              "legendFormat": "{{ instance }}"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null }
                ]
              }
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 0, "y": 16 },
          "id": 7,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Running Pods",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(kube_pod_status_phase{phase=\"Running\"})",
              "legendFormat": "Pods"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null }
                ]
              }
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 6, "y": 16 },
          "id": 8,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Deployments",
          "type": "stat",
          "targets": [
            {
              "expr": "count(kube_deployment_status_replicas)",
              "legendFormat": "Deployments"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null }
                ]
              }
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 12, "y": 16 },
          "id": 9,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Services",
          "type": "stat",
          "targets": [
            {
              "expr": "count(kube_service_info)",
              "legendFormat": "Services"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "red", "value": null },
                  { "color": "green", "value": 0 }
                ]
              }
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 18, "y": 16 },
          "id": 10,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Failed Pods",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(kube_pod_status_phase{phase=\"Failed\"}) or vector(0)",
              "legendFormat": "Failed"
            }
          ]
        }
      ],
      "refresh": "30s",
      "schemaVersion": 38,
      "tags": ["kubernetes", "cluster", "monitoring"],
      "templating": { "list": [] },
      "time": { "from": "now-1h", "to": "now" },
      "timepicker": {},
      "timezone": "browser",
      "title": "Kubernetes Cluster Overview",
      "uid": "k8s-cluster-overview",
      "version": 1,
      "weekStart": ""
    }
  falco-security.json: |
    {
      "annotations": { "list": [] },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 1 },
                  { "color": "red", "value": 10 }
                ]
              }
            }
          },
          "gridPos": { "h": 6, "w": 6, "x": 0, "y": 0 },
          "id": 1,
          "options": {
            "colorMode": "background",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["sum"] }
          },
          "title": "üö® Total Security Alerts",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(increase(falco_events{priority=~\"Critical|Warning|Error\"}[24h])) or vector(0)",
              "legendFormat": "Alerts (24h)"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "red", "value": 1 }
                ]
              }
            }
          },
          "gridPos": { "h": 6, "w": 6, "x": 6, "y": 0 },
          "id": 2,
          "options": {
            "colorMode": "background",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["sum"] }
          },
          "title": "üî¥ Critical Alerts",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(increase(falco_events{priority=\"Critical\"}[24h])) or vector(0)",
              "legendFormat": "Critical"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "orange", "value": 1 }
                ]
              }
            }
          },
          "gridPos": { "h": 6, "w": 6, "x": 12, "y": 0 },
          "id": 3,
          "options": {
            "colorMode": "background",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["sum"] }
          },
          "title": "‚ö†Ô∏è Warning Alerts",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(increase(falco_events{priority=\"Warning\"}[24h])) or vector(0)",
              "legendFormat": "Warning"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "red", "value": null },
                  { "color": "green", "value": 1 }
                ]
              }
            }
          },
          "gridPos": { "h": 6, "w": 6, "x": 18, "y": 0 },
          "id": 4,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"] }
          },
          "title": "Falco Status",
          "type": "stat",
          "targets": [
            {
              "expr": "up{job=\"falco\"}",
              "legendFormat": "{{ instance }}"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisLabel": "",
                "drawStyle": "bars",
                "fillOpacity": 80,
                "lineWidth": 1,
                "pointSize": 5,
                "showPoints": "never",
                "stacking": { "mode": "normal" }
              }
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
          "id": 5,
          "title": "Security Events Over Time",
          "type": "timeseries",
          "targets": [
            {
              "expr": "sum by (priority) (increase(falco_events[5m]))",
              "legendFormat": "{{ priority }}"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisLabel": "",
                "drawStyle": "bars",
                "fillOpacity": 80,
                "lineWidth": 1,
                "pointSize": 5,
                "showPoints": "never"
              }
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
          "id": 6,
          "title": "Events by Rule",
          "type": "timeseries",
          "targets": [
            {
              "expr": "sum by (rule) (increase(falco_events[1h]))",
              "legendFormat": "{{ rule }}"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "red", "value": 1 }
                ]
              },
              "mappings": [],
              "unit": "short"
            }
          },
          "gridPos": { "h": 6, "w": 8, "x": 0, "y": 14 },
          "id": 7,
          "options": {
            "colorMode": "background",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["sum"] }
          },
          "title": "üêö Shell Spawned in Container",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(increase(falco_events{rule=~\".*[Ss]hell.*\"}[24h])) or vector(0)",
              "legendFormat": "Shell Events"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "red", "value": 1 }
                ]
              },
              "mappings": [],
              "unit": "short"
            }
          },
          "gridPos": { "h": 6, "w": 8, "x": 8, "y": 14 },
          "id": 8,
          "options": {
            "colorMode": "background",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["sum"] }
          },
          "title": "üìÅ Sensitive File Access",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(increase(falco_events{rule=~\".*[Ss]ensitive.*\"}[24h])) or vector(0)",
              "legendFormat": "File Access"
            }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "orange", "value": 1 }
                ]
              },
              "mappings": [],
              "unit": "short"
            }
          },
          "gridPos": { "h": 6, "w": 8, "x": 16, "y": 14 },
          "id": 9,
          "options": {
            "colorMode": "background",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["sum"] }
          },
          "title": "üîß Kubectl Exec Detected",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(increase(falco_events{rule=~\".*[Ee]xec.*\"}[24h])) or vector(0)",
              "legendFormat": "Exec Events"
            }
          ]
        }
      ],
      "refresh": "30s",
      "schemaVersion": 38,
      "tags": ["security", "falco", "runtime"],
      "templating": { "list": [] },
      "time": { "from": "now-24h", "to": "now" },
      "timepicker": {},
      "timezone": "browser",
      "title": "Falco Security Dashboard",
      "uid": "falco-security",
      "version": 1,
      "weekStart": ""
    }
